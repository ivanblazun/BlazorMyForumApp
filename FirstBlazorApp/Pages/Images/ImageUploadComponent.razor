
@using FirstBlazorApp.Auth;
@using FirstBlazorApp.Models
@using System.Drawing;
@using System.Drawing.Imaging;
@using ForumAdminPanel.Models;

@inject AuthenticationStateProvider authStateProvider
@inject ImageService imageService
@inject UserService userService
@inject NavigationManager navManager

<div class="d-flex flex-column">
    <h3>ImageUploadComponent</h3>
    
    <div class="card" style="width: 18rem;">
      <img id="pic" width="150" height="150"/>
        <div class="card-body">
            <label for="img">Select image:</label>
            <InputFile class="custom-file-input"
                       oninput="pic.src=window.URL.createObjectURL(this.files[0])"
                       OnChange="OnInputFileChange" accept="image/png, image/jpeg, image/gif" id="inputFile" />
            <button onclick="@(()=>{SaveImage();})" type="button" class="w-50">Upload</button>
        </div>
    </div>

</div>


@code {

    public InputFileChangeEventArgs InputImage;

    private string imageSrc;
    protected override async Task OnInitializedAsync()
    {   
        var customAuthstateProvider = (AuthProccedure)authStateProvider;
        User user = await customAuthstateProvider.GetCurrentUserAsync();
        imageSrc = await imageService.GetImage(user);         
    }

    private void OnInputFileChange(InputFileChangeEventArgs e)
    {
        InputImage = e;
        this.StateHasChanged();
    }

    public async Task SaveImage()
    {
        var customAuthstateProvider = (AuthProccedure)authStateProvider;
        User user = await customAuthstateProvider.GetCurrentUserAsync();
        imageService.SaveImagetoDatabase(InputImage,user);
        string location = "/userprofile/" + user.Id.ToString();
        navManager.NavigateTo(location, true);
    }
}
